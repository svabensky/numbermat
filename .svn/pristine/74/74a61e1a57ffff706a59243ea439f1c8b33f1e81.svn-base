package Numbermat.Problems;

import Numbermat.Algorithms;
import Numbermat.GUI.utils.Configuration;
import Numbermat.Pair;
import Numbermat.Utils;
import java.util.ArrayList;
import java.util.List;

/**
 * System of 2, 3, or 4 linear congruences.
 * 
 * @author Valdemar Svabensky <395868@mail.muni.cz>
 */
public final class LinearCongruenceSystemProblem extends MathProblem {
    
    private int count;
    private List<Integer> aList;
    private List<Integer> bList;
    private List<Integer> nList;
    
    public LinearCongruenceSystemProblem(String difficulty) {
        Pair<Integer, Integer> bounds = Configuration.initBounds(difficulty);
        int lowerBound = bounds.getFirst() / 2;
        int upperBound = bounds.getSecond() / 2;
        
        int count1;
        switch (difficulty) {
            case "Lehká" : count1 = 2; break;
            case "Střední" : count1 = 3; break;
            case "Těžká" : count1 = 4; break;
            default: throw new IllegalArgumentException("Unknown difficulty.");
        }
        List<Integer> aList1 = new ArrayList<>(count1);
        List<Integer> bList1 = new ArrayList<>(count1);
        List<Integer> nList1 = new ArrayList<>(count1);
        
        for (int i = 0; i < count1; ++i) {
            int a1 = Algorithms.randInt(lowerBound, upperBound, false);
            int b1 = Algorithms.randInt(lowerBound, upperBound, true);
            int n1 = Algorithms.randInt(lowerBound, upperBound, false);
            aList1.add(a1);
            bList1.add(b1);
            nList1.add(n1);
        }
        setVariables(count1, aList1, bList1, nList1);
    }
    
    public LinearCongruenceSystemProblem(int count1, List<Integer> aList1, List<Integer> bList1, List<Integer> nList1) {
        setVariables(count1, aList1, bList1, nList1);
    }
    
    private void setVariables(int count1, List<Integer> aList1, List<Integer> bList1, List<Integer> nList1) {
        count = count1;
        aList = new ArrayList<>(aList1);
        bList = new ArrayList<>(bList1);
        nList = new ArrayList<>(nList1);
        Pair<Integer, Integer> solution = Algorithms.linearCongruenceSystem(count, aList, bList, nList);
        if (solution.equals(new Pair<Integer, Integer>()))
            result = new ArrayList<>();
        else {
            result = new ArrayList(2);
            result.add(solution.getFirst());
            result.add(solution.getSecond());
        }
        prepareAll();
    }
    
    @Override
    protected void prepareProblemPlaintext() {
        StringBuilder sb = new StringBuilder();
        for (int i = 0; i < count; ++i) {
            sb.append(aList.get(i)).append("x ≡ ").append(bList.get(i));
            sb.append(" (mod ").append(nList.get(i)).append(")").append(Utils.NEWLINE);
        }
        problemPlaintext = sb.toString();
    }

    @Override
    protected void prepareProblemLaTeX() {
        StringBuilder sb = new StringBuilder("\\[");
        for (int i = 0; i < count; ++i) {
            sb.append(aList.get(i)).append("x \\equiv ").append(bList.get(i));
            sb.append(" \\pmod{").append(nList.get(i)).append("}\\\\").append(Utils.NEWLINE);
        }
        problemLaTeX = sb.append("\\]").toString();
    }

    @Override
    protected void prepareSolutionPlaintext() {
        solutionPlaintext = Algorithms.linearCongruenceSystemSteps(count, aList, bList, nList);
    }

    @Override
    protected void prepareSolutionLaTeX() {
        String solutionCopy = Utils.prepareMathForLaTeX(solutionPlaintext);
        solutionCopy = solutionCopy.replace("|", "\\mid");
        if (count > 1) {
            solutionCopy = solutionCopy.replaceAll("Substituujeme", "\\text{Substituujeme");
            solutionCopy = solutionCopy.replaceAll("rovnice.", "rovnice.}");
        }
        if (result.equals(new ArrayList<>())) {
            solutionCopy = solutionCopy.replace("∤", "\\nmid");
            solutionCopy = solutionCopy.replace("Kongruence", "\\text{Kongruence");
            solutionCopy = solutionCopy.replace("řešení.", "řešení.}");
        }

        StringBuilder sb = new StringBuilder();
        sb.append("\\begin{align}").append(Utils.NEWLINE);
        sb.append(solutionCopy);
        Utils.insertLaTeXNewlineSymbol(sb, sb.lastIndexOf("{align}") + 9, false);
        sb.append("\\end{align}");
        solutionLaTeX = sb.toString();
    }
}
